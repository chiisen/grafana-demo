{
    "name": "ram-usage-alert",
    "interval": "1m",
    "rules": [
        {
            "expr": "",
            "for": "1m",
            "keep_firing_for": "0s",
            "grafana_alert": {
                "title": "ram-usage-alert",
                "condition": "C",
                "data": [
                    {
                        "refId": "A",
                        "queryType": "",
                        "relativeTimeRange": {
                            "from": 600,
                            "to": 0
                        },
                        "datasourceUid": "prometheus",
                        "model": {
                            "datasource": {
                                "type": "prometheus",
                                "uid": "prometheus"
                            },
                            "editorMode": "code",
                            "expr": "(1 - (node_memory_MemAvailable_bytes{job=\"node_exporter\"} / node_memory_MemTotal_bytes{job=\"node_exporter\"})) * 100",
                            "instant": false,
                            "intervalMs": 1000,
                            "maxDataPoints": 43200,
                            "range": true,
                            "refId": "A"
                        }
                    },
                    {
                        "refId": "B",
                        "queryType": "",
                        "relativeTimeRange": {
                            "from": 0,
                            "to": 0
                        },
                        "datasourceUid": "__expr__",
                        "model": {
                            "conditions": [
                                {
                                    "evaluator": {
                                        "params": [],
                                        "type": "gt"
                                    },
                                    "operator": {
                                        "type": "and"
                                    },
                                    "query": {
                                        "params": [
                                            "B"
                                        ]
                                    },
                                    "reducer": {
                                        "params": [],
                                        "type": "last"
                                    },
                                    "type": "query"
                                }
                            ],
                            "datasource": {
                                "type": "__expr__",
                                "uid": "__expr__"
                            },
                            "expression": "A",
                            "intervalMs": 1000,
                            "maxDataPoints": 43200,
                            "reducer": "last",
                            "refId": "B",
                            "type": "reduce"
                        }
                    },
                    {
                        "refId": "C",
                        "queryType": "",
                        "relativeTimeRange": {
                            "from": 0,
                            "to": 0
                        },
                        "datasourceUid": "__expr__",
                        "model": {
                            "conditions": [
                                {
                                    "evaluator": {
                                        "params": [
                                            60
                                        ],
                                        "type": "gt"
                                    },
                                    "operator": {
                                        "type": "and"
                                    },
                                    "query": {
                                        "params": [
                                            "C"
                                        ]
                                    },
                                    "reducer": {
                                        "params": [],
                                        "type": "last"
                                    },
                                    "type": "query"
                                }
                            ],
                            "datasource": {
                                "type": "__expr__",
                                "uid": "__expr__"
                            },
                            "expression": "B",
                            "intervalMs": 1000,
                            "maxDataPoints": 43200,
                            "refId": "C",
                            "type": "threshold"
                        }
                    }
                ],
                "no_data_state": "OK",
                "exec_err_state": "Error"
            },
            "annotations": {
                "summary": "High RAM Usage detected: {{ $values.B.Value | printf \"%.2f\" }}%",
                "description": "Server RAM usage is above threshold on instance {{ $labels.instance }}."
            },
            "labels": {
                "severity": "warning",
                "notify_policy": "fast"
            }
        }
    ]
}