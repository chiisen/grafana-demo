# Grafana Dashboard è¨»è§£æŒ‡å—

æœ¬æ–‡ä»¶èªªæ˜å¦‚ä½•åœ¨ Grafana Dashboard JSON é…ç½®ä¸­ä½¿ç”¨ `description` æ¬„ä½ä¾†æ·»åŠ è¨»è§£ã€‚

## ğŸ“‹ ç‚ºä»€éº¼ä½¿ç”¨ `description` æ¬„ä½ï¼Ÿ

ç”±æ–¼æ¨™æº– JSON æ ¼å¼ä¸æ”¯æ´è¨»è§£ï¼ˆ`//` æˆ– `/* */`ï¼‰ï¼Œæˆ‘å€‘ä½¿ç”¨ Grafana åŸç”Ÿæ”¯æ´çš„ `description` æ¬„ä½ä¾†æä¾›èªªæ˜æ–‡å­—ã€‚

### âœ… å„ªé»

1. **åŸç”Ÿæ”¯æ´**ï¼šGrafana æœƒåœ¨ UI ä¸­é¡¯ç¤ºé€™äº›èªªæ˜
2. **ä¸ç ´å£æ ¼å¼**ï¼šä¿æŒæ¨™æº– JSON æ ¼å¼
3. **ä½¿ç”¨è€…å‹å–„**ï¼šä½¿ç”¨è€…å¯ä»¥ç›´æ¥åœ¨ Dashboard ä¸Šçœ‹åˆ°èªªæ˜
4. **å¤šå±¤ç´šæ”¯æ´**ï¼šå¯åœ¨ Dashboardã€Panelã€Variable ç­‰å¤šå€‹å±¤ç´šæ·»åŠ 

---

## ğŸ¯ å¯ä»¥æ·»åŠ  `description` çš„ä½ç½®

### 1ï¸âƒ£ Dashboard å±¤ç´š

åœ¨ JSON æ ¹å±¤ç´šæ·»åŠ  `description`ï¼Œèªªæ˜æ•´å€‹ Dashboard çš„ç”¨é€”ã€‚

```json
{
    "description": "æ•´åˆå¤šå€‹æ‡‰ç”¨ç¨‹å¼çš„æ—¥èªŒç›£æ§ Dashboardï¼Œæ”¯æ´äº’å‹•å¼é‘½å–åˆ†æ...",
    "title": "Drilldown Combined Logs",
    "uid": "drilldown-combined-logs",
    ...
}
```

**åœ¨ Grafana UI ä¸­çš„é¡¯ç¤ºä½ç½®**ï¼š
- Dashboard è¨­å®šé é¢ (Settings â†’ General)
- Dashboard è³‡è¨Šé¢æ¿ (é»æ“Šæ¨™é¡Œæ—çš„ â„¹ï¸ åœ–ç¤º)

---

### 2ï¸âƒ£ Panel å±¤ç´š

åœ¨æ¯å€‹ Panel ä¸­æ·»åŠ  `description`ï¼Œèªªæ˜è©²é¢æ¿çš„åŠŸèƒ½ã€‚

```json
{
    "panels": [
        {
            "description": "é¡¯ç¤ºæ¯åˆ†é˜çš„æ—¥èªŒæ•¸é‡çµ±è¨ˆï¼ŒæŒ‰ Job å’Œ Level åˆ†çµ„...",
            "title": "Log Volume by Job and Level",
            "type": "timeseries",
            ...
        }
    ]
}
```

**åœ¨ Grafana UI ä¸­çš„é¡¯ç¤ºä½ç½®**ï¼š
- Panel æ¨™é¡Œä¸‹æ–¹ï¼ˆç•¶æ»‘é¼ ç§»åˆ° Panel æ¨™é¡Œçš„ â„¹ï¸ åœ–ç¤ºæ™‚é¡¯ç¤ºï¼‰
- Panel ç·¨è¼¯é é¢ (Edit â†’ Panel options â†’ Description)

---

### 3ï¸âƒ£ Variable å±¤ç´š

åœ¨è®Šæ•¸å®šç¾©ä¸­æ·»åŠ  `description`ï¼Œèªªæ˜è®Šæ•¸çš„ç”¨é€”å’Œå¯é¸å€¼ã€‚

```json
{
    "templating": {
        "list": [
            {
                "description": "é¸æ“‡è¦æŸ¥çœ‹çš„æ‡‰ç”¨ç¨‹å¼ã€‚å¯é¸å€¼ï¼šapiã€laravelã€order-lifecycle...",
                "name": "job",
                "label": "Job",
                ...
            }
        ]
    }
}
```

**åœ¨ Grafana UI ä¸­çš„é¡¯ç¤ºä½ç½®**ï¼š
- è®Šæ•¸ä¸‹æ‹‰é¸å–®æ—çš„æç¤º (æ»‘é¼ ç§»åˆ°è®Šæ•¸åç¨±ä¸Šæ™‚)
- Dashboard è¨­å®šé é¢ (Settings â†’ Variables)

---

## ğŸ“ å·²æ·»åŠ è¨»è§£çš„æª”æ¡ˆ

### `drilldown-combined-logs.json`

å·²åœ¨ä»¥ä¸‹ä½ç½®æ·»åŠ è©³ç´°çš„ `description` æ¬„ä½ï¼š

#### âœ… Dashboard å±¤ç´š
```json
"description": "æ•´åˆå¤šå€‹æ‡‰ç”¨ç¨‹å¼çš„æ—¥èªŒç›£æ§ Dashboardï¼Œæ”¯æ´äº’å‹•å¼é‘½å–åˆ†æã€‚
åŒ…å« APIã€Laravel å’Œ Order Lifecycle ä¸‰å€‹æ‡‰ç”¨çš„æ—¥èªŒã€‚
ä½¿ç”¨ Loki ä½œç‚ºè³‡æ–™ä¾†æºï¼Œæä¾›æ—¥èªŒæ•¸é‡çµ±è¨ˆå’ŒåŸå§‹æ—¥èªŒæŸ¥çœ‹åŠŸèƒ½ã€‚
æ”¯æ´æŒ‰ Jobï¼ˆæ‡‰ç”¨ç¨‹å¼ï¼‰å’Œ Levelï¼ˆæ—¥èªŒç­‰ç´šï¼‰é€²è¡Œéæ¿¾ã€‚"
```

#### âœ… Panel 1: Log Volume by Job and Level
```json
"description": "é¡¯ç¤ºæ¯åˆ†é˜çš„æ—¥èªŒæ•¸é‡çµ±è¨ˆï¼ŒæŒ‰ Jobï¼ˆæ‡‰ç”¨ç¨‹å¼ï¼‰å’Œ Levelï¼ˆæ—¥èªŒç­‰ç´šï¼‰åˆ†çµ„ã€‚
ä½¿ç”¨å †ç–Šé•·æ¢åœ–å‘ˆç¾ï¼Œåœ–ä¾‹é¡¯ç¤ºç¸½è¨ˆæ•¸ã€‚
æ”¯æ´é»æ“Šåœ–ä¾‹é€²è¡Œ Drilldown é‘½å–ï¼Œè‡ªå‹•éæ¿¾ä¸‹æ–¹çš„æ—¥èªŒé¢æ¿ã€‚
æŸ¥è©¢èªæ³•ï¼šsum by (job, level) (count_over_time({job=~\"${job:regex}\", level=~\"${level:regex}\"}[1m]))"
```

#### âœ… Panel 2: Combined Logs
```json
"description": "é¡¯ç¤ºåŸå§‹æ—¥èªŒå…§å®¹ï¼Œæ•´åˆ APIã€Laravel å’Œ Order Lifecycle ä¸‰å€‹æ‡‰ç”¨çš„æ—¥èªŒã€‚
æ”¯æ´ç„¡é™æ»¾å‹•ã€æ—¥èªŒè©³ç´°è³‡è¨Šå±•é–‹ã€æ¨™ç±¤é¡¯ç¤ºç­‰åŠŸèƒ½ã€‚
æ—¥èªŒæŒ‰æ™‚é–“é™åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨ä¸Šæ–¹ï¼‰ã€‚
å¯é€éä¸Šæ–¹çš„ Job å’Œ Level è®Šæ•¸é€²è¡Œéæ¿¾ï¼Œæˆ–é»æ“Šåœ–è¡¨é€²è¡Œ Drilldown é‘½å–ã€‚
æŸ¥è©¢èªæ³•ï¼š{job=~\"${job:regex}\", level=~\"${level:regex}\"}"
```

#### âœ… Variable: job
```json
"description": "é¸æ“‡è¦æŸ¥çœ‹çš„æ‡‰ç”¨ç¨‹å¼ã€‚
å¯é¸å€¼ï¼šapiï¼ˆAPI æœå‹™ï¼‰ã€laravelï¼ˆLaravel æ‡‰ç”¨ï¼‰ã€order-lifecycleï¼ˆè¨‚å–®ç”Ÿå‘½é€±æœŸæœå‹™ï¼‰ã€‚
é è¨­ç‚º Allï¼ˆé¡¯ç¤ºæ‰€æœ‰æ‡‰ç”¨ï¼‰ã€‚
æ­¤è®Šæ•¸ä½¿ç”¨æ­£å‰‡è¡¨é”å¼æ ¼å¼ï¼Œç•¶é¸æ“‡ All æ™‚æœƒåŒ¹é… api|laravel|order-lifecycleã€‚"
```

#### âœ… Variable: level
```json
"description": "é¸æ“‡è¦æŸ¥çœ‹çš„æ—¥èªŒç­‰ç´šã€‚
æ”¯æ´æ¨™æº–çš„æ—¥èªŒç­‰ç´šï¼šDEBUGï¼ˆé™¤éŒ¯ï¼‰ã€INFOï¼ˆè³‡è¨Šï¼‰ã€NOTICEï¼ˆæ³¨æ„ï¼‰ã€WARNINGï¼ˆè­¦å‘Šï¼‰ã€
ERRORï¼ˆéŒ¯èª¤ï¼‰ã€CRITICALï¼ˆåš´é‡ï¼‰ã€ALERTï¼ˆå‘Šè­¦ï¼‰ã€EMERGENCYï¼ˆç·Šæ€¥ï¼‰ã€‚
é è¨­ç‚º Allï¼ˆé¡¯ç¤ºæ‰€æœ‰ç­‰ç´šï¼‰ã€‚
æ­¤è®Šæ•¸ä½¿ç”¨æ­£å‰‡è¡¨é”å¼æ ¼å¼ï¼Œç•¶é¸æ“‡ All æ™‚æœƒåŒ¹é…æ‰€æœ‰ç­‰ç´šï¼ˆ.*ï¼‰ã€‚"
```

---

## ğŸ¨ åœ¨ Grafana UI ä¸­æŸ¥çœ‹è¨»è§£

### æ–¹æ³• 1ï¸âƒ£ï¼šæŸ¥çœ‹ Dashboard èªªæ˜

1. é–‹å•Ÿ Dashboard
2. é»æ“Šå³ä¸Šè§’çš„ **âš™ï¸ Dashboard settings**
3. åœ¨ **General** é ç±¤ä¸­å¯ä»¥çœ‹åˆ° Dashboard çš„ `description`

### æ–¹æ³• 2ï¸âƒ£ï¼šæŸ¥çœ‹ Panel èªªæ˜

1. å°‡æ»‘é¼ ç§»åˆ° Panel æ¨™é¡Œä¸Š
2. é»æ“Šæ¨™é¡Œæ—çš„ **â„¹ï¸** åœ–ç¤º
3. æœƒé¡¯ç¤º Panel çš„ `description`

æˆ–è€…ï¼š

1. é»æ“Š Panel æ¨™é¡Œ
2. é¸æ“‡ **Edit**
3. åœ¨å³å´çš„ **Panel options** ä¸­å¯ä»¥çœ‹åˆ° **Description** æ¬„ä½

### æ–¹æ³• 3ï¸âƒ£ï¼šæŸ¥çœ‹ Variable èªªæ˜

1. é»æ“Šå³ä¸Šè§’çš„ **âš™ï¸ Dashboard settings**
2. é¸æ“‡ **Variables** é ç±¤
3. é»æ“Šä»»ä¸€è®Šæ•¸é€²è¡Œç·¨è¼¯
4. å¯ä»¥çœ‹åˆ° **Description** æ¬„ä½

---

## ğŸ“ æ’°å¯« Description çš„æœ€ä½³å¯¦è¸

### âœ… æ‡‰è©²åŒ…å«çš„å…§å®¹

1. **åŠŸèƒ½èªªæ˜**ï¼šé€™å€‹ Panel/Variable åšä»€éº¼ï¼Ÿ
2. **è³‡æ–™ä¾†æº**ï¼šå¾å“ªè£¡å–å¾—è³‡æ–™ï¼Ÿ
3. **æŸ¥è©¢é‚è¼¯**ï¼šä½¿ç”¨ä»€éº¼æŸ¥è©¢èªæ³•ï¼Ÿï¼ˆç‰¹åˆ¥æ˜¯è¤‡é›œæŸ¥è©¢ï¼‰
4. **äº’å‹•æ–¹å¼**ï¼šä½¿ç”¨è€…å¯ä»¥å¦‚ä½•æ“ä½œï¼Ÿ
5. **æ³¨æ„äº‹é …**ï¼šæœ‰ä»€éº¼éœ€è¦ç‰¹åˆ¥æ³¨æ„çš„åœ°æ–¹ï¼Ÿ

### âœ… ç¯„ä¾‹ï¼šå¥½çš„ Panel Description

```json
"description": "é¡¯ç¤ºæ¯åˆ†é˜çš„æ—¥èªŒæ•¸é‡çµ±è¨ˆï¼ŒæŒ‰ Jobï¼ˆæ‡‰ç”¨ç¨‹å¼ï¼‰å’Œ Levelï¼ˆæ—¥èªŒç­‰ç´šï¼‰åˆ†çµ„ã€‚
ä½¿ç”¨å †ç–Šé•·æ¢åœ–å‘ˆç¾ï¼Œåœ–ä¾‹é¡¯ç¤ºç¸½è¨ˆæ•¸ã€‚
æ”¯æ´é»æ“Šåœ–ä¾‹é€²è¡Œ Drilldown é‘½å–ï¼Œè‡ªå‹•éæ¿¾ä¸‹æ–¹çš„æ—¥èªŒé¢æ¿ã€‚
æŸ¥è©¢èªæ³•ï¼šsum by (job, level) (count_over_time({job=~\"${job:regex}\", level=~\"${level:regex}\"}[1m]))"
```

**åŒ…å«äº†**ï¼š
- âœ… åŠŸèƒ½èªªæ˜ï¼ˆé¡¯ç¤ºæ—¥èªŒæ•¸é‡çµ±è¨ˆï¼‰
- âœ… åˆ†çµ„æ–¹å¼ï¼ˆæŒ‰ Job å’Œ Levelï¼‰
- âœ… è¦–è¦ºåŒ–æ–¹å¼ï¼ˆå †ç–Šé•·æ¢åœ–ï¼‰
- âœ… äº’å‹•åŠŸèƒ½ï¼ˆDrilldown é‘½å–ï¼‰
- âœ… æŸ¥è©¢èªæ³•ï¼ˆå®Œæ•´çš„ LogQLï¼‰

### âŒ ç¯„ä¾‹ï¼šä¸å¥½çš„ Panel Description

```json
"description": "æ—¥èªŒåœ–è¡¨"
```

**å•é¡Œ**ï¼š
- âŒ å¤ªç°¡çŸ­ï¼Œæ²’æœ‰æä¾›æœ‰ç”¨è³‡è¨Š
- âŒ æ²’æœ‰èªªæ˜åŠŸèƒ½
- âŒ æ²’æœ‰èªªæ˜å¦‚ä½•ä½¿ç”¨

---

## ğŸ”§ å¦‚ä½•ç‚ºå…¶ä»– Dashboard æ·»åŠ è¨»è§£

### æ­¥é©Ÿ 1ï¼šè­˜åˆ¥éœ€è¦è¨»è§£çš„ä½ç½®

åœ¨ JSON æª”æ¡ˆä¸­æ‰¾åˆ°ï¼š
- Dashboard æ ¹å±¤ç´šï¼ˆç¬¬ 1 è¡Œé™„è¿‘ï¼‰
- æ¯å€‹ Panelï¼ˆåœ¨ `panels` é™£åˆ—ä¸­ï¼‰
- æ¯å€‹ Variableï¼ˆåœ¨ `templating.list` é™£åˆ—ä¸­ï¼‰

### æ­¥é©Ÿ 2ï¼šæ·»åŠ  description æ¬„ä½

åœ¨å°æ‡‰çš„ç‰©ä»¶ä¸­æ·»åŠ  `"description"` æ¬„ä½ï¼Œé€šå¸¸æ”¾åœ¨ç‰©ä»¶çš„é–‹é ­ï¼š

```json
{
    "description": "é€™è£¡æ˜¯èªªæ˜æ–‡å­—",
    "å…¶ä»–æ¬„ä½": "..."
}
```

### æ­¥é©Ÿ 3ï¼šé©—è­‰ JSON æ ¼å¼

ä½¿ç”¨ Python çš„ json.tool é©—è­‰ï¼š

```bash
python3 -m json.tool dashboard.json > /dev/null && echo "âœ… æ ¼å¼æ­£ç¢º" || echo "âŒ æ ¼å¼éŒ¯èª¤"
```

### æ­¥é©Ÿ 4ï¼šé‡æ–°è¼‰å…¥ Grafana

å¦‚æœä½¿ç”¨ Provisioningï¼š
```bash
docker-compose restart grafana
```

æˆ–æ‰‹å‹•é‡æ–°åŒ¯å…¥ Dashboardã€‚

---

## ğŸŒ æ”¯æ´å¤šèªè¨€

`description` æ¬„ä½æ”¯æ´ Unicodeï¼Œå¯ä»¥ä½¿ç”¨ç¹é«”ä¸­æ–‡æˆ–å…¶ä»–èªè¨€ï¼š

```json
{
    "description": "é€™æ˜¯ç¹é«”ä¸­æ–‡çš„èªªæ˜æ–‡å­— ğŸ¯",
    "title": "Dashboard Title"
}
```

**æ³¨æ„**ï¼šJSON æª”æ¡ˆå¿…é ˆä½¿ç”¨ UTF-8 ç·¨ç¢¼ã€‚

---

## ğŸ“Š ç¯„ä¾‹ï¼šå®Œæ•´çš„ Panel çµæ§‹

```json
{
    "description": "ç›£æ§ CPU ä½¿ç”¨ç‡ï¼Œé¡¯ç¤ºæ‰€æœ‰æ ¸å¿ƒçš„å¹³å‡ä½¿ç”¨ç™¾åˆ†æ¯”ã€‚ç•¶ CPU ä½¿ç”¨ç‡è¶…é 85% æ™‚é¡¯ç¤ºè­¦å‘Šï¼ˆé»ƒè‰²ï¼‰ï¼Œè¶…é 95% æ™‚é¡¯ç¤ºå‘Šè­¦ï¼ˆç´…è‰²ï¼‰ã€‚æŸ¥è©¢èªæ³•ï¼š100 * (1 - avg(rate(node_cpu_seconds_total{mode=\"idle\"}[$__rate_interval])))",
    "datasource": {
        "type": "prometheus",
        "uid": "prometheus"
    },
    "fieldConfig": {
        "defaults": {
            "thresholds": {
                "steps": [
                    {"color": "green", "value": null},
                    {"color": "yellow", "value": 85},
                    {"color": "red", "value": 95}
                ]
            },
            "unit": "percent"
        }
    },
    "gridPos": {"h": 4, "w": 6, "x": 0, "y": 0},
    "id": 1,
    "title": "CPU Usage",
    "type": "gauge"
}
```

---

## ğŸ”— ç›¸é—œè³‡æº

- [Grafana Panel Options æ–‡æª”](https://grafana.com/docs/grafana/latest/panels-visualizations/configure-panel-options/)
- [Grafana Variables æ–‡æª”](https://grafana.com/docs/grafana/latest/dashboards/variables/)
- [JSON æ ¼å¼è¦ç¯„](https://www.json.org/)

---

## âœ… æª¢æŸ¥æ¸…å–®

åœ¨æäº¤ Dashboard JSON ä¹‹å‰ï¼Œç¢ºèªï¼š

- [ ] Dashboard å±¤ç´šæœ‰ `description`
- [ ] æ¯å€‹ Panel éƒ½æœ‰ `description`
- [ ] æ¯å€‹ Variable éƒ½æœ‰ `description`ï¼ˆå¦‚æœæœ‰ä½¿ç”¨è®Šæ•¸ï¼‰
- [ ] Description å…§å®¹æ¸…æ™°ã€å®Œæ•´
- [ ] åŒ…å«æŸ¥è©¢èªæ³•èªªæ˜ï¼ˆå°æ–¼è¤‡é›œæŸ¥è©¢ï¼‰
- [ ] JSON æ ¼å¼é©—è­‰é€šé
- [ ] åœ¨ Grafana UI ä¸­æ¸¬è©¦éé¡¯ç¤ºæ•ˆæœ
- [ ] ä½¿ç”¨ UTF-8 ç·¨ç¢¼å„²å­˜æª”æ¡ˆ

---

## ğŸ’¡ æç¤º

å¦‚æœ `description` å…§å®¹å¾ˆé•·ï¼Œå¯ä»¥åœ¨ JSON ä¸­ä½¿ç”¨è·³è„«å­—å…ƒ `\n` ä¾†æ›è¡Œï¼š

```json
{
    "description": "ç¬¬ä¸€è¡Œèªªæ˜\nç¬¬äºŒè¡Œèªªæ˜\nç¬¬ä¸‰è¡Œèªªæ˜"
}
```

åœ¨ Grafana UI ä¸­æœƒé¡¯ç¤ºç‚ºï¼š
```
ç¬¬ä¸€è¡Œèªªæ˜
ç¬¬äºŒè¡Œèªªæ˜
ç¬¬ä¸‰è¡Œèªªæ˜
```
